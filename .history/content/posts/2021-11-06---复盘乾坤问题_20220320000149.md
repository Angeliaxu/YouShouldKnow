---
title: 复盘升级webpack遇到的乾坤问题
date: "2021-11-6"
template: "post"
draft: false
slug: "/post/qiankun-problem"
category: "JAVASCRIPT"
tags:
  - "JAVASCRIPT"
description: "复盘升级webpack遇到的乾坤问题"
socialImage: "/media/42-line-bible.jpg"
---


最近在做webpack4到5的技术升级，项目主要用到的技术栈是qiankun，在完成webpack升级之后，子应用打开路由懒加载，会出现如下错误：
![qiankun-error.png](/media/qiankun-error.png)
由于对乾坤是第一次接触，对于其运行原理不了解，导致自己走了很多弯路，第一个弯路就是根据上面的报错去查找子应用的错误，陷入到错误的方向。在此方向上探索了几天无果，于是采取另外一种方式：造最小demo。   
但是在demo里不会出现类似的错误，想想可能是主应用出了问题，接着又往主应用的方向排查，结果是主应用的锅，主应用有这样一段代码：
![qiankun-main-app.png](/media/qiankun-main-app.png)
先记住这段代码，熟悉webpack的知道异步chunk的加载是走JsonP的方式，那就需要用script标签初始化数据接着appendChild script标签。在debug过程中，发现使用上面的问题代码webpack使用的appendChild是这样的：
![qiankun-error-appendChild.png](/media/qiankun-error-appendChild.png)
被乾坤代理过的appendChild应该是这样
![appendChild-correct.png](/media/appendChild-correct.png)
appendChild是一方面，接下来看另外一方面
![qiankun-sandbox-correct.png](/media/qiankun-sandbox-correct.png)
![qiankun-sandbox.png](/media/qiankun-sandbox.png)
